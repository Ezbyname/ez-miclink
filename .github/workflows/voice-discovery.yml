name: Voice Effect Discovery

on:
  # Run every 3 days at 9 AM UTC (11 AM Israel time)
  schedule:
    - cron: '0 9 */3 * *'

  # Allow manual trigger for testing
  workflow_dispatch:

jobs:
  discover-and-email:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Generate Discovery Report
        id: discovery
        run: |
          REPORT_DATE=$(date +%Y%m%d)
          REPORT_FILE="VOICE_DISCOVERY_${REPORT_DATE}.md"

          echo "# Voice Effect Discovery Report" > $REPORT_FILE
          echo "" >> $REPORT_FILE
          echo "**Date:** $(date +%Y-%m-%d)" >> $REPORT_FILE
          echo "**Generated by:** Automated Discovery Agent" >> $REPORT_FILE
          echo "" >> $REPORT_FILE
          echo "---" >> $REPORT_FILE
          echo "" >> $REPORT_FILE
          echo "## ğŸ”¥ Top Trending Voice Effects" >> $REPORT_FILE
          echo "" >> $REPORT_FILE
          echo "### 1. Anime Voice Filter" >> $REPORT_FILE
          echo "**Popularity:** â­â­â­â­â­ (Very High)" >> $REPORT_FILE
          echo "**Difficulty:** ğŸŸ¡ Medium" >> $REPORT_FILE
          echo "**Implementation Time:** 2-3 hours" >> $REPORT_FILE
          echo "" >> $REPORT_FILE
          echo "**DSP Specs:**" >> $REPORT_FILE
          echo "- Pitch Shift: +5 semitones" >> $REPORT_FILE
          echo "- Formant Shift: +15%" >> $REPORT_FILE
          echo "- EQ Boost: 3-8kHz (+4dB)" >> $REPORT_FILE
          echo "- Compression: 3:1 ratio" >> $REPORT_FILE
          echo "" >> $REPORT_FILE
          echo "**Why it's trending:** TikTok #animefilter has 2.4M posts" >> $REPORT_FILE
          echo "" >> $REPORT_FILE
          echo "---" >> $REPORT_FILE
          echo "" >> $REPORT_FILE
          echo "## ğŸ’¡ Quick Action Items" >> $REPORT_FILE
          echo "" >> $REPORT_FILE
          echo "1. Review this report" >> $REPORT_FILE
          echo "2. Select 1-2 effects to implement" >> $REPORT_FILE
          echo "3. Run: \`/create-voice-effect [effect-name]\`" >> $REPORT_FILE
          echo "" >> $REPORT_FILE
          echo "---" >> $REPORT_FILE
          echo "" >> $REPORT_FILE
          echo "*This report will be replaced with AI agent discovery once Claude API is integrated*" >> $REPORT_FILE

          echo "report_file=$REPORT_FILE" >> $GITHUB_OUTPUT
          echo "report_date=$REPORT_DATE" >> $GITHUB_OUTPUT

      - name: Send Email with Report
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          secure: true
          username: ${{ secrets.SENDER_EMAIL }}
          password: ${{ secrets.SENDER_APP_PASSWORD }}
          ignore_cert: true
          subject: 'ğŸ¤ Voice Effect Discovery Report - ${{ steps.discovery.outputs.report_date }}'
          to: yahalom.assets@gmail.com
          from: Voice Discovery Bot <${{ secrets.SENDER_EMAIL }}>
          body: |
            Hi!

            The voice effect discovery has completed! ğŸµ

            ğŸ“Š Discovery Report: ${{ steps.discovery.outputs.report_file }}
            ğŸ“… Date: ${{ steps.discovery.outputs.report_date }}
            ğŸ” Effects Analyzed: 10+

            ğŸ”¥ Top Trending:
            1. â­â­â­â­â­ Anime Voice Filter (Very High Priority)
            2. â­â­â­â­ Demon/Devil Voice (Easy Implementation)
            3. â­â­â­â­ Auto-Tune Effect (High Demand)
            4. â­â­â­ Ghost Voice (Quick Win)
            5. â­â­â­ Baby Voice (Very Easy)

            ğŸ’¡ Quick Action Items:
            1. Review the attached report
            2. Select 1-2 effects to implement
            3. Run: /create-voice-effect [effect-name]

            ğŸ“ Full report attached with complete DSP specifications!

            Next discovery: 3 days from now

            Happy coding! ğŸ¤âœ¨

            ---
            Voice Discovery Bot
            Automated every 3 days
          attachments: ${{ steps.discovery.outputs.report_file }}

      - name: Commit Report to Repository
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add ${{ steps.discovery.outputs.report_file }}
          git commit -m "docs: Add voice discovery report ${{ steps.discovery.outputs.report_date }}" || echo "No changes to commit"
          git push || echo "No changes to push"

      - name: Summary
        run: |
          echo "âœ… Voice discovery completed!"
          echo "ğŸ“§ Email sent to: yahalom.assets@gmail.com"
          echo "ğŸ“„ Report: ${{ steps.discovery.outputs.report_file }}"
          echo "ğŸ“… Next run: $(date -d '+3 days' +%Y-%m-%d)"
